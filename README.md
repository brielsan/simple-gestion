# Simple Gesti√≥n

üåê **Live Demo**: [simplegestion.net](https://simplegestion.net)

Simple Gesti√≥n is a personal finance management application I designed to help users track their income and expenses, visualize their financial habits, and receive personalized advice to improve their financial health. This project was developed to showcase a modern web application stack.

## Features

- **User Authentication**: Secure user registration and login system using JWT.
- **Dashboard**: An overview of the user's financial status, including total income, expenses, and recent activity.
- **Transaction Management**: Users can add, edit, and delete their income and expense movements.
- **Categorization**: Transactions are categorized to provide better insights into spending habits.
- **Data Visualization**: Interactive charts to visualize financial data, such as spending by category.
- **AI-Powered Advice**: Integration with Google's Gemini API to provide users with personalized financial advice based on their transaction history.

## Tech Stack

This project is built with a modern, robust, and scalable technology stack:

- **Framework**: [Next.js](https://nextjs.org/) 15.5.3 (App Router)
- **Language**: JavaScript
- **UI Components**: [shadcn/ui](https://ui.shadcn.com/), which uses Radix UI for accessible and unstyled primitives, and `lucide-react` for icons.
- **Styling**: [Tailwind CSS](https://tailwindcss.com/)
- **Database ORM**: [Prisma](https://www.prisma.io/) for type-safe database access.
- **Database**: [PostgreSQL](https://www.postgresql.org/)
- **Authentication**: Custom JWT-based authentication with middleware for route protection.
- **Data Fetching**: [SWR](https://swr.vercel.app/) for efficient client-side data fetching and caching.
- **AI Integration**: [Google Gemini API](https://ai.google.dev/) for generating financial advice.

## Core Concepts & Architecture

### Infrastructure Diagram

![Infrastructure Diagram of simplegestion.net](./infra-diagram.jpg)

_[View infrastructure diagram of simplegestion.net in source](./infra-diagram.jpg)_

### Application Architecture

![Architecture Diagram](./diagram.jpg)

_[View diagram in source](./diagram.jpg)_

### Authentication and Session Management

Authentication is handled using JSON Web Tokens (JWT). When a user logs in, a token is generated and stored in an HTTP-only cookie for security.

The `middleware.js` file plays a crucial role in protecting routes. It intercepts incoming requests and checks for a valid `auth-token`. If the token is missing or invalid, the user is redirected to the login page. This ensures that only authenticated users can access the dashboard and other protected areas of the application.

### Data Fetching and Caching with SWR

I use `useSWR` (stale-while-revalidate) for client-side data fetching. This strategy provides an excellent user experience by first returning cached data (stale), then sending a fetch request to get the latest data (revalidate), and finally updating the UI with the fresh data.

This is particularly useful in a financial app where data can change frequently. When a user adds a new transaction, a revalidation of the relevant SWR keys can be triggered, causing the UI to update automatically across all components that use that data, ensuring consistency without manual state management.

### Database and Prisma ORM

The application uses a PostgreSQL database, with Prisma as the Object-Relational Mapper (ORM). Prisma provides a type-safe API for database queries, which helps prevent common errors and increases developer productivity.

The database schema (`prisma/schema.prisma`) defines the following core models:

- `User`: Stores user information, including credentials.
- `Movement`: Represents a single financial transaction (income or expense). It is linked to a `User`, a `Category`, and a `Type`.
- `Category`: Defines categories for transactions (e.g., "Food", "Transport").
- `Type`: Differentiates between transaction types (e.g., "Income", "Expense").
- `Advice`: Stores the financial advice generated by the AI for each user.

### AI-Powered Financial Advice with Gemini

A key feature of Simple Gesti√≥n is its ability to provide personalized financial advice. This is achieved by leveraging the Google Gemini API.

When a user requests advice, the backend service (`services/api/ai-service.js`) gathers relevant financial data for that user, including:

- Total income and expenses.
- Spending distribution by category.
- Recent transaction history.

A carefully crafted prompt is constructed with this data and sent to the Gemini API. The prompt instructs the AI to act as a financial advisor and generate practical, actionable advice. The response is then saved to the database and displayed to the user.

To prevent abuse, there is a limit of 5 advice requests per user per day.

## Getting Started

To run this project locally, follow these steps:

1.  **Clone the repository:**

    ```bash
    git clone <repository-url>
    cd simple-gestion
    ```

2.  **Install dependencies:**

    ```bash
    npm install
    ```

3.  **Set up the database:**

    - Make sure you have a PostgreSQL server running.
    - Create a `.env` file in the root of the project and add your database connection string:
      ```
      DATABASE_URL="postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=public"
      ```
    - Apply the database schema using Prisma:
      ```bash
      npx prisma migrate dev
      ```

4.  **Set up environment variables:**

    - Create a `.env` file in the root of the project and add the following variables:

      ```
      # Database connection
      DATABASE_URL="postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=public"

      # JWT Secret for authentication
      JWT_SECRET="your-secret"

      # API Key for seeding data (types and categories)
      API_KEY="api-key-for-seeding"

      # Google Gemini API for AI-powered financial advice
      GEMINI_API_KEY="your-gemini-api-key"
      GEMINI_API_URL="https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent"
      ```

5.  **Seed the database with initial data:**

    After setting up the environment variables, you need to populate the database with initial transaction types and categories. Execute the seed endpoint with your API key (`process.env.API_KEY`):

    ```bash
    curl "http://localhost:3000/api/seed?apikey=api-key-for-seeding"
    ```

    This endpoint will:

    - Read the `exampleData.json` file from the `lib/` directory
    - Extract unique types and categories from the example data
    - Create the corresponding records in the database
    - Return a JSON response with the created types and categories

    **About `exampleData.json`:**

    The `lib/exampleData.json` file contains a comprehensive dataset of sample financial transactions with various categories (groceries, rent, utilities, dining, transportation, entertainment, healthcare, shopping) and types (income, expense). This data serves two purposes:

    1. **Database Seeding**: The `/api/seed` endpoint uses this data to populate the database with initial transaction types and categories.
    2. **Mock-up Data**: Users can load this sample data into their account using the "Load Mock-up" button in the application header.

    **Load Mock-up Feature:**

    Once logged in, users will find a "Load Mock-up" button in the header dropdown menu. This feature:

    - Loads all transactions from `exampleData.json` into the user's account
    - Only works for users who don't have any existing movements (prevents data duplication)
    - Creates realistic sample data to help users explore the application's features
    - Shows a success message with the number of movements created

6.  **Run the development server:**
    ```bash
    npm run dev
    ```

Open [http://localhost:3000](http://localhost:3000) in your browser to see the application.
